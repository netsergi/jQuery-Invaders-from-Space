<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link href="https://fonts.googleapis.com/css?family=Anton" rel="stylesheet">
	<style>
		main { 
				width: 800px;
				height: 600px; 
				margin: 50px auto; 
				position: relative; 
			    background: url("img/fondo.jpg") 0% 50% repeat; 
				-webkit-animation-name: mueve-fondo;
				-webkit-animation-duration: 25s;
				-webkit-animation-timing-function: linear;
				-webkit-animation-iteration-count: infinite; }

		#nave {
				width: 100px;
				height: auto; 
				position: absolute; 
			    z-index: 1;}
	
		#rayo, #rayo_malo { 
				width: 5px;
				height: 5px;
				border-radius: 80%;
				display: inline-block;
				background-color: yellow; 
				position: absolute;
				z-index: 0;
			 }

		#rayo_malo { background-color: red; }

		.malo {
				width: 100px;
				height: auto;
				position: absolute;
				top: 10px; 
				z-index: 1;
				left: 80px;
		}

		.puntos {
					position: absolute;
					top: 5px;
					left: 10px;
					color: white;
					font-size: 1.8em;
					font-family: 'Anton', sans-serif;
					padding: 0px 10px 0px 10px;
					border-radius: 5px;
					background-color: blue;
		}

		.contenedorEnergia {
					width: 400px;
					height: 40px;
					top: 5px;
					border-radius: 20px;
					position: absolute;
					border: 5px solid darkorange;
		}

		.energia {
					width: 100%;
					border-radius: 20px;
					height: 30px;
					background-color: yellow; 
		}

		@-webkit-keyframes 	mueve-fondo {
   			    from { background-position: 0 100%; }
    			to { background-position: 0 0; }
   		}
}

	</style>
</head>
<body>
	<main class="jumbotron">
		<div class="puntos">0</div>
		<div class="contenedorEnergia">
			<div class="energia"></div>
		</div>
		<div class="gameOver">GAME OVER</div>
		<img id="nave" src="img/nave.png" />
		<img class="malo" src="img/malo1.png" />
	</main>
	<script>
		
		var malo = $(".malo");
		var puntos = 0;
		

		$(document).ready(function(){
			var nave = $("#nave");
			var fondo = $("main");
			var tope = fondo.width() - nave.width();
			var colisionan = false;

			var centrarDiv = parseInt(fondo.css("width").replace("px","") /2) - (parseInt($(".contenedorEnergia").css("width").replace("px","") / 2));			
			$(".contenedorEnergia").css("left", centrarDiv)
		  	nave.css("top",fondo.outerHeight() - nave.height());
		  	nave.css("left", (fondo.width()/2 - nave.width()/2) +"px");
		  	var navepos = nave.position();
		  	var fondopos = fondo.position();

		  	fondo.append("<div id='rayo_malo'></div");
		  	var rayoMalo = $("#rayo_malo");
		  	var maloPos = malo.position();
		  	rayoMalo.css("top",maloPos.top + malo.outerHeight());
		  	rayoMalo.css("left",maloPos.left + (malo.outerWidth() /2));

		  	var mueve_malo = setInterval(function(){
		  		malo.css("top","+=10");
		  		var fondoTope = parseInt(fondo.css("height").replace("px",""))-parseInt(fondo.css("margin").replace("px",""))
				if (parseInt(malo.css("top").replace("px","")) >= fondoTope )
				{
					clearInterval(mueve_malo);
				}
		  	},400);	  

		  	
		  	function posicionaRayoMalo ()
		  	{
		  		var posiniRayo =parseInt(malo.css("top").replace("px","")) + 50;
		  		rayoMalo.css("top", posiniRayo+"px");
		  	}


		  	var mueve_rayo_malo = setInterval(function(){
		  		rayoMalo.css("top","+=10");
		  		colisionan = colision(nave,rayoMalo);
		  		if (colisionan)
		  		{
		  			/*$(".energia").css("width","-=1");
		  			$("#nave").css("filter","opacity(50%)");
		  			setTimeout(function(){
		  				$("#nave").css("filter","opacity(100%)");},150);

		  			if (parseInt($(".energia").css("width").replace("px","")) <= 0)
		  			{
		  				clearInterval(mueve_rayo_malo);
		  				clearInterval(mueve_malo);
		  				clearInterval(mover_rayo);
		  				$(".malo").remove();
		  				$("#rayo_malo").remove();
		  				$("#nave").css("display","none");
		  			}
		  			colisionan = false;*/
		  		}

		  		if (rayoMalo.css("top").replace("px","") > fondo.outerHeight()-10)
		  		{
		  			posicionaRayoMalo();
		  		}
		  	},50);	  	

		  	$(document).keydown(function(e){
		  		
		  		switch (e.keyCode)
		  		{
		  			case 39:
			  			if (navepos.left < tope)
				  			{
			  					nave.animate({left: "+=20"}, 0);
			  					navepos = nave.position();
				  			}
		  			break;
		  			case 37:
		  				nave.attr("src","img/naveleft.png");
			  			if (navepos.left >= 0)
			  				{
			  					nave.animate({left: "-=20"}, 0);
			  					navepos = nave.position();
			  				}
			  		break;
			  		case 32:
			  			if (!rayo)
			  			{
			  				fondo.append("<div id='rayo'></div>");
			  				var rayo = $("#rayo");
			  				rayoTop = navepos.top - rayo.height();
			  				rayoLeft = navepos.left + (nave.width() /2) - (rayo.width() /2);
			  				rayo.css({left: rayoLeft, top: rayoTop });
			  				var rayoPos = rayo.position();
			  				var disparar = setInterval("mover_rayo()",50);	
			  			}	  			
			  		break;
		  		} 		
		  	});

		});

			function colision(elem1, elem2)
			{
				var elem1Pos = elem1.position();
				var elem2Pos = elem2.position();
				var topelem1 = elem1.outerWidth() + elem2Pos.left;
				var m = elem1.attr("id");
				switch (m)
				{
					case "malo":
						if (elem2Pos.left > elem1Pos.left && elem2Pos.top < elem1Pos.top && elem2Pos.left < topelem1)
						{
							return true;
						}
					break;
					case "nave":
						if (elem2Pos.left > elem1Pos.left && elem2Pos.top > elem1Pos.top && elem2Pos.left < topelem1)
						{
							return true;
						}
					break;

				}

				
			}

		    function mover_rayo()
		  	{
				if ($("#rayo").length)
				{
					$("#rayo").css("top","-=20");
					if ($("#rayo").css("top").replace("px","") > $("main").css("top").replace("px",""))
					{
						colisionan = colision($(".malo"),$("#rayo"));
						if (colisionan)
						{
							$("#rayo").remove();
							++puntos;
							$(".puntos").html(puntos);
							$(".malo").attr("src","img/explosion.png");
							setTimeout(function(){
								$(".malo").css("display", "none");
							},300);
							setTimeout(function(){
								$(".malo").css("display", "block");
								$(".malo").attr("src","img/malo1.png");
								$(".malo").css("top","0");
							},350);
						colisonan = false;
						}

					}
					else
					{
						$("#rayo").remove();
					}
				}														 		
		  	}

	</script>
</body>
</html>